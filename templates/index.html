<!DOCTYPE html>
<html lang="en">

        
<head>
    <meta charset="UTF-8">
    <link rel="icon" href = "mbta.png" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
            integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI="
            crossorigin=""
            />
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
            integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM="
            crossorigin="">
    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <style>
        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
        }
    </style>
    <style>.leaflet-popup-content-wrapper, .leaflet-popup-tip { background: rgb(0, 0, 0, 0.95) !important;} </style>
    <title>MBTA System Map</title>
</head>

<body>
    <div id="map"></div>
    <script>
        var map = L.map('map').setView([42.3519, -71.0552], 13);

        // var CartoDB_Positron = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
        //    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
        //    subdomains: 'abcd',
        //    maxZoom: 20
        //}).addTo(map);
        
        var CartoDB_DarkMatter = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
            subdomains: 'abcd',
            maxZoom: 20
        }).addTo(map);

        // Create a layer group for the vehicles
        var vehicle_layer = L.layerGroup().addTo(map);

        var basemaps = {
            "Dark": CartoDB_DarkMatter
        };

        var overlays = {
            "Vehicles": vehicle_layer
        };

        var layerControl = L.control.layers(overlays).addTo(map);
        getVehicleLocations();

        // calls function every 15 seconds
        var intervalId = window.setInterval(function () {
            getVehicleLocations();
        }, 15000);


        function getVehicleLocations() {


   
            $.getJSON("/vehicles/", function(vehicle_dict) {
                console.log(vehicle_dict);
                vehicle_layer.clearLayers();
                for (var i = 0; i < vehicle_dict.length; i++) {
                    var marker = L.marker([vehicle_dict[i].latitude, vehicle_dict[i].longitude]).addTo(vehicle_layer);
                    var popup = marker.bindPopup(vehicle_dict[i].vehicle_id); 
                }
            });
        }

        function getStops() {
            $.getJSON("/stops/", function(stops_dict) {
                console.log(stops_dict);
                for (var i = 0; i < stops_dict.length; i++) {
                    var marker = L.marker([stops_dict[i].latitude, stops_dict[i].longitude]).addTo(map);
                    var popup = marker.bindPopup(stops_dict[i].stop_name); 
                }
            });
        }
        </script>

</body>

</html>